pdb=7UPE
mdp=~/md/mdp/amber/

wget https://files.rcsb.org/download/$pdb.pdb
pdbfixer $pdb.pdb --output=protein.pdb --add-atoms=heavy --replace-nonstandard

# PREP
gmx pdb2gmx -f protein.pdb -o protein_gmx.gro -p topol.top -ignh -ff amber03 -water tip3p

# 잔기 이름 LIG로 변경
sed -i 's/UNK/LIG/g' LIG.pdb

# 파라미터 작성
acpype -i LIG.pdb -o gmx

# protein, lig - gro 파일 합치기
$gmx/merge_gro protein_gmx.gro ./LIG.acpype/LIG_GMX.gro -o protein_lig.gro

# topology 파일 수정
$gmx/config_topol topol.top

# Solvation 
gmx editconf -f protein_lig.gro -o protein_box.gro -c -d 1.0 -bt cubic
gmx solvate -cp protein_box.gro -cs spc216.gro -o protein_solv.gro -p topol.top

# Add Ions
gmx grompp -f ${mdp}/ions.mdp -c protein_solv.gro -p topol.top -o ions.tpr
echo "SOL" | gmx genion -s ions.tpr -o protein_ion.gro -p topol.top -pname NA -nname CL -neutral

# EM
gmx grompp -f ${mdp}/em.mdp -c protein_ion.gro -p topol.top -o em.tpr
gmx mdrun -v -deffnm em -nb gpu

# NVT
gmx grompp -f ${mdp}/nvt.mdp -c em.gro -r em.gro -p topol.top -o nvt.tpr
gmx mdrun -v -deffnm nvt -nb gpu

# NPT
gmx grompp -f ${mdp}/npt.mdp -c nvt.gro -r nvt.gro -p topol.top -o npt.tpr
gmx mdrun -v -deffnm npt -nb gpu
