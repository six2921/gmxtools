mdp=~/md/mdp/amber

# PREP
gmx pdb2gmx -f protein.pdb -o protein_gmx.gro -p topol.top -ignh -ff amber03 -water tip3p

# Solvation 
gmx editconf -f protein_gmx.gro -o protein_box.gro -c -d 1.0 -bt cubic
gmx solvate -cp protein_box.gro -cs spc216.gro -o protein_solv.gro -p topol.top

# Add Ions
gmx grompp -f ${mdp}/ions.mdp -c protein_solv.gro -p topol.top -o ions.tpr
echo "SOL" | gmx genion -s ions.tpr -o protein_ion.gro -p topol.top -pname NA -nname CL -neutral

# EM
gmx grompp -f ${mdp}/em.mdp -c protein_ion.gro -p topol.top -o em.tpr
gmx mdrun -v -deffnm em -nb gpu

# NVT
gmx grompp -f ${mdp}/nvt.mdp -c em.gro -r em.gro -p topol.top -o nvt.tpr
gmx mdrun -v -deffnm nvt -nb gpu

# NPT
gmx grompp -f ${mdp}/npt.mdp -c nvt.gro -r nvt.gro -p topol.top -o npt.tpr
gmx mdrun -v -deffnm npt -nb gpu
